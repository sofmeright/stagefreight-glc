export_dependencies:
  stage: build
  image: alpine:3.22.1
  before_script:
    - apk add --no-cache git rsync tree
  script:
    - git clone "https://$CI_SERVER_HOST/components/stagefreight.git" --branch main --depth 1 stagefreight_repo
    - rsync -avz stagefreight_repo/artifacts/ ./artifacts/ || true
    - rsync -avz stagefreight_repo/assets/ ./assets/ || true
    - rsync -avz stagefreight_repo/scripts/ ./scripts/ || true
    - rsync -avz stagefreight_repo/templates/ ./templates/ || true
    - echo "Copied dependent files to artifacts paths:"
    - tree artifacts assets scripts templates
    - echo "--- CI/CD Variable Debug ---"
    - echo "Releasing from branch- $CI_COMMIT_REF_NAME"
    - echo "Pipeline ID- $CI_PIPELINE_ID"
    - echo "API URL- $CI_API_V4_URL"
    - echo "Project ID- $CI_PROJECT_ID"
    - echo "Current tag- $CI_COMMIT_TAG"
  artifacts:
    paths:
      - assets/
      - artifacts/
      - scripts/
      - templates/
    expire_in: 1 hour
  only:
    - tags